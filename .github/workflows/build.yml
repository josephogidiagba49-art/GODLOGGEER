name: ðŸ—ï¸ Build GodKeyLogger
on: [push]

jobs:
  build:
    runs-on: windows-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4
      
    - name: ðŸ” Find Visual Studio Version
      shell: cmd
      run: |
        echo Checking Visual Studio installation...
        dir "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\VC\Tools\MSVC\"
        echo.
        echo Looking for cl.exe...
        
    - name: ðŸ› ï¸ Build (Automatic Discovery)
      shell: cmd
      run: |
        echo ====================================
        echo   BUILDING GOD KEYLOGGER
        echo ====================================
        
        :: Method 1: Use Developer Command Prompt
        echo Method 1: Using VsDevCmd...
        call "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\Common7\Tools\VsDevCmd.bat" -arch=x64
        
        :: Check if cl.exe works
        cl.exe /? >nul 2>&1
        if %errorlevel% equ 0 (
            echo âœ… cl.exe is working!
            
            :: Build with basic options
            cl.exe /nologo /EHsc /O2 /DUNICODE /D_UNICODE /MT ^
              GodKeyLogger.cpp ^
              /link /SUBSYSTEM:WINDOWS /OUT:GodKeyLogger.exe ^
              user32.lib gdi32.lib advapi32.lib winhttp.lib crypt32.lib
        ) else (
            echo âŒ cl.exe not found via VsDevCmd
            goto method2
        )
        
        goto verify
        
        :method2
        echo.
        echo Method 2: Searching for cl.exe...
        
        :: Find cl.exe
        where /R "C:\Program Files\Microsoft Visual Studio\" cl.exe > cl_location.txt 2>nul
        set /p CLPATH=<cl_location.txt
        
        if "%CLPATH%"=="" (
            echo âŒ cl.exe not found, trying final method...
            goto method3
        )
        
        echo Found cl.exe at: %CLPATH%
        "%CLPATH%" /nologo /EHsc /O2 /DUNICODE /D_UNICODE /MT ^
          GodKeyLogger.cpp ^
          /link /SUBSYSTEM:WINDOWS /OUT:GodKeyLogger.exe ^
          user32.lib gdi32.lib advapi32.lib winhttp.lib crypt32.lib
          
        goto verify
        
        :method3
        echo.
        echo Method 3: Using PowerShell to find compiler...
        
        powershell -Command "`
        `$cl = Get-ChildItem -Path 'C:\Program Files\Microsoft Visual Studio' -Recurse -Filter 'cl.exe' -ErrorAction SilentlyContinue | Select-Object -First 1; `
        if (`$cl) { `
            Write-Host 'Found cl.exe at: ' `$cl.FullName; `
            & `$cl.FullName /nologo /EHsc /O2 GodKeyLogger.cpp /link /SUBSYSTEM:WINDOWS /OUT:GodKeyLogger.exe user32.lib gdi32.lib advapi32.lib winhttp.lib; `
            if (`$LASTEXITCODE -eq 0) { Write-Host 'Build successful!' } `
        } else { `
            Write-Host 'ERROR: No compiler found!'; `
            exit 1 `
        }"
        
        :verify
        echo.
        
    - name: âœ… Verify Build
      shell: cmd
      run: |
        if exist GodKeyLogger.exe (
            echo âœ… BUILD SUCCESSFUL!
            echo ðŸ“ File: GodKeyLogger.exe
            
            for %%F in (GodKeyLogger.exe) do (
                echo ðŸ“¦ Size: %%~zF bytes
            )
            
            echo.
            echo ====================================
            echo   READY FOR DEPLOYMENT
            echo ====================================
        ) else (
            echo âŒ BUILD FAILED - Creating diagnostic file...
            echo Creating diagnostic information...
            
            :: Create a test file to see what's wrong
            echo #include <windows.h> > test.cpp
            echo int WINAPI WinMain(HINSTANCE, HINSTANCE, LPSTR, int) { return 0; } >> test.cpp
            
            :: Try to compile a simple test
            cl.exe /nologo /EHsc /O2 test.cpp /link /SUBSYSTEM:WINDOWS /OUT:test.exe user32.lib 2>&1
            
            dir *.exe
            dir *.cpp
            exit 1
        )
        
    - name: ðŸ“¤ Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: GodKeyLogger-Executable
        path: GodKeyLogger.exe
        retention-days: 30
