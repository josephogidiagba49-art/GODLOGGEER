name: ğŸ”¥ GodKeyLogger Build & Release

on:
  push:
    branches: [ main, master ]
    tags: [ 'v*' ]
  workflow_dispatch:
    inputs:
      release_type:
        description: 'Release Type'
        required: true
        default: 'patch'
        type: choice
        options:
        - patch
        - minor
        - major

env:
  BUILD_TYPE: 'Release'
  PROJECT_NAME: 'GodKeyLogger'

jobs:
  build-windows:
    name: ğŸªŸ Build Windows Executable
    runs-on: windows-latest
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        
    - name: ğŸ”§ Setup MSVC
      uses: microsoft/setup-msbuild@v1.1
      
    - name: ğŸ—ï¸ Build Executable
      shell: cmd
      run: |
        echo ================================
        echo   BUILDING GOD KEYLOGGER v2.0
        echo ================================
        
        cl /EHsc /Ox /W2 /DUNICODE /D_UNICODE /MT /std:c++17 ^
          GodKeyLogger.cpp ^
          /link /SUBSYSTEM:WINDOWS /OUT:GodKeyLogger.exe ^
          user32.lib gdi32.lib advapi32.lib winhttp.lib crypt32.lib
        
        if %errorlevel% neq 0 exit 1
        
    - name: âœ… Verify Build
      shell: cmd
      run: |
        if not exist GodKeyLogger.exe (
          echo "âŒ BUILD FAILED: Executable not created"
          exit 1
        )
        
        for %%F in (GodKeyLogger.exe) do (
          set size=%%~zF
        )
        
        echo "âœ… BUILD SUCCESSFUL"
        echo "ğŸ“ File: GodKeyLogger.exe"
        echo "ğŸ“¦ Size: %size% bytes"
        echo "ğŸ• Time: %time%"
        
    - name: ğŸ”’ Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: GodKeyLogger-Windows
        path: GodKeyLogger.exe
        retention-days: 7
        
    - name: ğŸ·ï¸ Create GitHub Release
      if: startsWith(github.ref, 'refs/tags/')
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        name: GodKeyLogger ${{ github.ref_name }}
        draft: false
        prerelease: false
        generate_release_notes: true
        files: |
          GodKeyLogger.exe
        
    - name: ğŸ“¤ Upload to Release (Manual Trigger)
      if: github.event_name == 'workflow_dispatch'
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: manual-${{ github.run_number }}
        name: Manual Build #${{ github.run_number }}
        draft: true
        files: GodKeyLogger.exe
